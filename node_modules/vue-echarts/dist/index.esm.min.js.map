{"version":3,"file":"index.esm.min.js","sources":["../src/composables/api.ts","../src/composables/autoresize.ts","../src/composables/loading.ts","../node_modules/style-inject/dist/style-inject.es.js","../src/utils.ts","../src/ECharts.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { Ref, unref } from \"vue-demi\";\nimport { EChartsType, Option } from \"../types\";\n\nconst METHOD_NAMES = [\n  \"getWidth\",\n  \"getHeight\",\n  \"getDom\",\n  \"getOption\",\n  \"resize\",\n  \"dispatchAction\",\n  \"convertToPixel\",\n  \"convertFromPixel\",\n  \"containPixel\",\n  \"getDataURL\",\n  \"getConnectedDataURL\",\n  \"appendData\",\n  \"clear\",\n  \"isDisposed\",\n  \"dispose\"\n] as const;\ntype MethodName = typeof METHOD_NAMES[number];\n\ntype PublicMethods = Pick<EChartsType, MethodName>;\n\nexport function usePublicAPI(\n  chart: Ref<EChartsType | undefined>,\n  init: (option?: Option) => void\n) {\n  function makePublicMethod<T extends MethodName>(\n    name: T\n  ): (...args: Parameters<EChartsType[T]>) => ReturnType<EChartsType[T]> {\n    return (...args) => {\n      if (!chart.value) {\n        init();\n      }\n\n      if (!chart.value) {\n        throw new Error(\"ECharts is not initialized yet.\");\n      }\n      return (chart.value[name] as any).apply(chart.value, args);\n    };\n  }\n\n  function makeAnyMethod<T extends MethodName>(\n    name: T\n  ): (...args: any[]) => ReturnType<EChartsType[T]> {\n    return makePublicMethod(name) as any;\n  }\n\n  function makePublicMethods(): PublicMethods {\n    const methods = Object.create(null);\n    METHOD_NAMES.forEach(name => {\n      methods[name] = makePublicMethod(name);\n    });\n\n    return methods as PublicMethods;\n  }\n\n  return {\n    ...makePublicMethods(),\n    dispatchAction: makeAnyMethod(\"dispatchAction\"),\n    getDataURL: makeAnyMethod(\"getDataURL\"),\n    getConnectedDataURL: makeAnyMethod(\"getConnectedDataURL\")\n  };\n}\n","import { Ref, watch } from \"vue-demi\";\nimport { throttle } from \"echarts/core\";\nimport { addListener, removeListener, ResizeCallback } from \"resize-detector\";\nimport { EChartsType, Option } from \"../types\";\n\nexport function useAutoresize(\n  chart: Ref<EChartsType | undefined>,\n  autoresize: Ref<boolean>,\n  root: Ref<HTMLElement | undefined>,\n  option: Ref<Option>\n): void {\n  let resizeListener: ResizeCallback | null = null;\n  let lastArea = 0;\n\n  function getArea() {\n    const el = root.value;\n    if (!el) {\n      return 0;\n    }\n    return el.offsetWidth * el.offsetHeight;\n  }\n\n  watch([root, chart, autoresize], ([root, chart, autoresize], _, cleanup) => {\n    if (root && chart && autoresize) {\n      lastArea = getArea();\n      resizeListener = throttle(() => {\n        if (lastArea === 0) {\n          chart.setOption(Object.create(null), true);\n          chart.resize();\n          chart.setOption(option.value, true);\n        } else {\n          chart.resize();\n        }\n        lastArea = getArea();\n      }, 100);\n\n      addListener(root, resizeListener);\n    }\n\n    cleanup(() => {\n      if (resizeListener && root) {\n        lastArea = 0;\n        removeListener(root, resizeListener);\n      }\n    });\n  });\n}\n\nexport const autoresizeProps = {\n  autoresize: Boolean\n};\n","import { inject, unref, computed, Ref, watchEffect } from \"vue-demi\";\nimport { EChartsType } from \"../types\";\n\nexport const LOADING_OPTIONS_KEY = \"ecLoadingOptions\";\n\nexport function useLoading(\n  chart: Ref<EChartsType | undefined>,\n  loading: Ref<boolean>,\n  loadingOptions: Ref<object | undefined>\n): void {\n  const defaultLoadingOptions = inject(LOADING_OPTIONS_KEY, {}) as\n    | object\n    | Ref<object>;\n  const realLoadingOptions = computed(() => ({\n    ...unref(defaultLoadingOptions),\n    ...loadingOptions?.value\n  }));\n\n  watchEffect(() => {\n    const instance = chart.value;\n    if (!instance) {\n      return;\n    }\n\n    if (loading.value) {\n      instance.showLoading(realLoadingOptions.value);\n    } else {\n      instance.hideLoading();\n    }\n  });\n}\n\nexport const loadingProps = {\n  loading: Boolean,\n  loadingOptions: Object\n};\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","type Attrs = {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n};\n\n// Copied from\n// https://github.com/vuejs/vue-next/blob/5a7a1b8293822219283d6e267496bec02234b0bc/packages/shared/src/index.ts#L40-L41\nconst onRE = /^on[^a-z]/;\nexport const isOn = (key: string) => onRE.test(key);\n\nexport function omitOn(attrs: Attrs) {\n  const result: Attrs = {};\n  for (const key in attrs) {\n    if (!isOn(key)) {\n      result[key] = attrs[key];\n    }\n  }\n\n  return result;\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  defineComponent,\n  unref,\n  shallowRef,\n  toRef,\n  toRefs,\n  watch,\n  computed,\n  inject,\n  onMounted,\n  onUnmounted,\n  h,\n  nextTick,\n  PropType,\n  watchEffect,\n  Vue2\n} from \"vue-demi\";\nimport { init as initChart } from \"echarts/core\";\nimport {\n  EChartsType,\n  Option,\n  Theme,\n  ThemeInjection,\n  InitOptions,\n  InitOptionsInjection,\n  UpdateOptions,\n  UpdateOptionsInjection\n} from \"./types\";\nimport {\n  usePublicAPI,\n  useAutoresize,\n  autoresizeProps,\n  useLoading,\n  loadingProps\n} from \"./composables\";\nimport \"./style.css\";\nimport { omitOn } from \"./utils\";\n\nconst TAG_NAME = \"x-vue-echarts\";\n\nif (Vue2) {\n  Vue2.config.ignoredElements.push(TAG_NAME);\n}\n\nexport const THEME_KEY = \"ecTheme\";\nexport const INIT_OPTIONS_KEY = \"ecInitOptions\";\nexport const UPDATE_OPTIONS_KEY = \"ecUpdateOptions\";\nexport { LOADING_OPTIONS_KEY } from \"./composables\";\n\nexport default defineComponent({\n  name: \"echarts\",\n  props: {\n    option: Object as PropType<Option>,\n    theme: {\n      type: [Object, String] as PropType<Theme>\n    },\n    initOptions: Object as PropType<InitOptions>,\n    updateOptions: Object as PropType<UpdateOptions>,\n    group: String,\n    manualUpdate: Boolean,\n    ...autoresizeProps,\n    ...loadingProps\n  },\n  inheritAttrs: false,\n  created() {\n    console.log(this);\n  },\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  // @ts-expect-error\n  setup(props, { attrs, listeners }) {\n    type T = Required<typeof props>;\n    const root = shallowRef<HTMLElement>();\n    const chart = shallowRef<EChartsType>();\n    const manualOption = shallowRef<Option>();\n    const defaultTheme = inject(THEME_KEY, null) as ThemeInjection;\n    const defaultInitOptions = inject(\n      INIT_OPTIONS_KEY,\n      null\n    ) as InitOptionsInjection;\n    const defaultUpdateOptions = inject(UPDATE_OPTIONS_KEY, {\n      lazyUpdate: true\n    }) as UpdateOptionsInjection;\n    const realOption = computed(\n      () => manualOption.value || props.option || Object.create(null)\n    );\n    const realTheme = computed(() => props.theme || unref(defaultTheme) || {});\n    const realInitOptions = computed(\n      () => props.initOptions || unref(defaultInitOptions) || {}\n    );\n    const realUpdateOptions = computed(\n      () => props.updateOptions || unref(defaultUpdateOptions) || {}\n    );\n\n    const { autoresize, manualUpdate, loading } = toRefs(props);\n\n    const theme = toRef(props, \"theme\");\n    const initOptions = toRef(props, \"initOptions\");\n    const loadingOptions = toRef(props, \"loadingOptions\");\n\n    const nonEventAttrs = computed(() => omitOn(attrs));\n\n    function init(option?: Option) {\n      if (chart.value || !root.value) {\n        return;\n      }\n\n      const instance = (chart.value = initChart(\n        root.value,\n        realTheme.value,\n        realInitOptions.value\n      ));\n\n      if (props.group) {\n        instance.group = props.group;\n      }\n\n      let realListeners = listeners;\n      if (!realListeners) {\n        realListeners = {};\n\n        Object.keys(attrs)\n          .filter(key => key.indexOf(\"on\") === 0 && key.length > 2)\n          .forEach(key => {\n            // onClick    -> c + lick\n            // onZr:click -> z + r:click\n            const event = key.charAt(2).toLowerCase() + key.slice(3);\n            realListeners[event] = attrs[key];\n          });\n      }\n\n      Object.keys(realListeners).forEach(key => {\n        const handler = realListeners[key] as any;\n\n        if (!handler) {\n          return;\n        }\n\n        if (key.indexOf(\"zr:\") === 0) {\n          instance.getZr().on(key.slice(3).toLowerCase(), handler);\n        } else {\n          instance.on(key.toLowerCase(), handler);\n        }\n      });\n\n      instance.setOption(option || realOption.value, realUpdateOptions.value);\n\n      function resize() {\n        if (instance && !instance.isDisposed()) {\n          // temporarily suppress errors caused by https://github.com/apache/echarts/issues/14846\n          try {\n            instance.resize();\n          } catch (e) {\n            if (e.message === \"Cannot read property 'get' of undefined\") {\n              return;\n            }\n\n            throw e;\n          }\n        }\n      }\n\n      if (autoresize.value) {\n        // Try to make chart fit to container in case container size\n        // is changed synchronously or in already queued microtasks\n        nextTick(resize);\n      }\n    }\n\n    function setOption(option: Option, updateOptions?: UpdateOptions) {\n      if (props.manualUpdate) {\n        manualOption.value = option;\n      }\n\n      if (!chart.value) {\n        init(option);\n      } else {\n        chart.value.setOption(option, updateOptions || {});\n      }\n    }\n\n    function cleanup() {\n      if (chart.value) {\n        chart.value.dispose();\n        chart.value = undefined;\n      }\n    }\n\n    let unwatchOption: (() => void) | null = null;\n    watch(\n      manualUpdate,\n      manualUpdate => {\n        if (typeof unwatchOption === \"function\") {\n          unwatchOption();\n          unwatchOption = null;\n        }\n\n        if (!manualUpdate) {\n          unwatchOption = watch(\n            () => props.option,\n            option => {\n              if (!option) {\n                return;\n              }\n              if (!chart.value) {\n                init();\n              } else {\n                chart.value.setOption(option, realUpdateOptions.value);\n              }\n            },\n            { deep: true }\n          );\n        }\n      },\n      {\n        immediate: true\n      }\n    );\n\n    watch(\n      [theme, initOptions],\n      () => {\n        cleanup();\n        init();\n      },\n      {\n        deep: true\n      }\n    );\n\n    watchEffect(() => {\n      if (props.group && chart.value) {\n        chart.value.group = props.group;\n      }\n    });\n\n    const publicApi = usePublicAPI(chart, init);\n\n    useLoading(chart, loading, loadingOptions);\n\n    useAutoresize(chart, autoresize, root, realOption);\n\n    onMounted(() => {\n      if (props.option) {\n        init();\n      }\n    });\n\n    onUnmounted(cleanup);\n\n    return {\n      chart,\n      root,\n      setOption,\n      nonEventAttrs,\n      ...publicApi\n    };\n  },\n  render() {\n    const attrs = { ...this.nonEventAttrs };\n    attrs.ref = \"root\";\n    attrs.class = attrs.class ? [\"echarts\"].concat(attrs.class) : \"echarts\";\n    return h(TAG_NAME, attrs);\n  }\n});\n"],"names":["METHOD_NAMES","autoresizeProps","autoresize","Boolean","LOADING_OPTIONS_KEY","loadingProps","loading","loadingOptions","Object","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","onRE","isOn","key","test","Vue2","config","ignoredElements","push","THEME_KEY","INIT_OPTIONS_KEY","UPDATE_OPTIONS_KEY","defineComponent","name","props","option","theme","String","initOptions","updateOptions","group","manualUpdate","inheritAttrs","created","console","log","this","setup","_a","attrs","listeners","root","shallowRef","chart","manualOption","defaultTheme","inject","defaultInitOptions","defaultUpdateOptions","lazyUpdate","realOption","computed","value","create","realTheme","unref","realInitOptions","realUpdateOptions","_b","toRefs","toRef","nonEventAttrs","result","omitOn","init","instance","initChart","realListeners","keys","filter","indexOf","length","forEach","event","charAt","toLowerCase","slice","handler","getZr","on","setOption","nextTick","isDisposed","resize","e","message","cleanup","dispose","undefined","unwatchOption","watch","deep","immediate","watchEffect","publicApi","makePublicMethod","_i","args","Error","apply","makeAnyMethod","methods","dispatchAction","getDataURL","getConnectedDataURL","usePublicAPI","defaultLoadingOptions","realLoadingOptions","showLoading","hideLoading","useLoading","resizeListener","lastArea","getArea","el","offsetWidth","offsetHeight","_","throttle","addListener","removeListener","useAutoresize","onMounted","onUnmounted","render","class","concat","h"],"mappings":"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"}